BootStrap: docker
From: python:2.7.16-alpine3.10

%labels
        Maintainer Team113 Wellcome Sanger Institute
        Version v1.0.0

%environment
        export LC_ALL=en_US.UTF-8
        export LANG=en_US.UTF-8

%apprun BAGEL-calc_foldchange.py
        exec  BAGEL-calc_foldchange.py "$@"

%apprun BAGEL.py
        exec BAGEL.py "$@"

%runscript
        exec BAGEL.py "$@"

%post
        # Link python
        ln -s /usr/local/bin/python /usr/bin/python
        
        # Get python dependencies
        pip install --no-cache-dir numpy==1.15.4 scipy pandas
        
        # Get BAGEL scripts and reference files
        apk add wget
        wget -O /usr/local/bin/BAGEL-calc_foldchange.py https://sourceforge.net/p/bagel-for-knockout-screens/code/ci/master/tree/BAGEL-calc_foldchange.py?format=raw
        wget -O /usr/local/bin/BAGEL.py https://sourceforge.net/p/bagel-for-knockout-screens/code/ci/master/tree/BAGEL.py?format=raw
        wget -O /usr/local/training_essentials.txt https://sourceforge.net/projects/bagel-for-knockout-screens/files/training_essentials.txt
        wget -O /usr/local/training_nonessential.txt https://sourceforge.net/projects/bagel-for-knockout-screens/files/training_nonessential.txt

        # Update permissions
        chmod +x /usr/local/bin/BAGEL*
