Bootstrap: docker
From: centos:centos7
IncludeCmd: no

%help
Help message

%labels
        Maintainer Team113 Wellcome Sanger Institute
        Version v1.0.0
        R_Version 3.6.0

%environment
        export LC_ALL=en_US.UTF-8
        export LANG=en_US.UTF-8
        export TEXINPUTS=".:/usr/local/share/fonts:" 

%apprun R
        exec R "$@"

%apprun Rscript
        exec Rscript "$@"

%runscript
        exec R "$@"

%post
        # Software versions
         export R_VERSION=3.6.0

        # Language
        export LC_ALL=en_US.UTF-8
        export LANG=en_US.UTF-8

        # Get dependencies
        yum update -y
        yum install -y \
                        bzip bzip2-devel \
                        cairo-devel \
                        firefox \
                        gcc \
                        gcc-gfortran \
                        gcc-c++ \
                        git \
                        java-1.8.0-openjdk-devel \
                        libcurl-devel \
                        libjpeg-turbo libjpeg-devel \
                        libpng libpng-devel \
                        libtiff libtiff-devel \
                        libXt-devel \
                        libX11-devel \
                        make \
                        perl-Tk \
                        pcre-devel \
                        readline-devel \
                        tar \
                        tcl-devel \
                        texinfo \
                        texlive texlive-latex texlive-xetex \
                        texlive-helvetic \
                        texlive-metafont \
                        texlive-psnfss \
                        texlive-times \
                        tk-devel \
                        unzip \
                        vim-minimal \
                        wget \
                        which \
                        xdg-utils \
                        xorg-x11-server-devel \
                        zlib zlib-devel 

        # Download and link missing fonts
        mkdir /usr/local/share/fonts
        wget http://mirrors.ctan.org/fonts/inconsolata/tex/inconsolata.sty -O /usr/local/share/fonts/inconsolata.sty
        export TEXINPUTS=".:/usr/local/share/fonts:"

        # Download R
        cd /tmp
        curl -O https://cran.r-project.org/src/base/R-3/R-${R_VERSION}.tar.gz
        tar -xf R-${R_VERSION}.tar.gz
        cd R-${R_VERSION}

        # Configure
        ./configure     --enable-R-shlib \
                                --enable-memory-profiling \
                                --with-readline \
                                --with-blas \
                                --with-tcltk \
                                --disable-nls \
                                --with-cairo \
                                --with-recommended-packages
        # Build and install
        make -j4
        make install
        make install-libR
        make check
        
        # Clean up
        yum clean all && rm -rf /var/cache/yum
        rm -rf /tmp/${R_VERSION}
        

